{{ 'section-testimonials.css' | asset_url | stylesheet_tag }}

{% render 'section-paddings',
  padding_top: section.settings.padding_top,
  padding_bottom: section.settings.padding_bottom,
  padding_top_mobile: section.settings.padding_top_mobile,
  padding_bottom_mobile: section.settings.padding_bottom_mobile
%}

{% capture sliderSettings %}
    {
      "slidesPerView": "auto",
      "navigation": {
        "nextEl": ".testimonials .slider-navigation__button--next",
        "prevEl": ".testimonials .slider-navigation__button--prev"
      }
    }
{% endcapture %}

{%- liquid
  assign testimonial_blocks = section.blocks | where: 'type', 'testimonial'
  assign statistic_blocks = section.blocks | where: 'type', 'statistic'
-%}

<div class="testimonials page-width section-{{ section.id }}--padding">
  <div class="testimonials__slider-wrapper">
    {%- if testimonial_blocks.size > 0 -%}
      <div
        class="swiper testimonials__slider"
        {% render 'slider-attribute', config: sliderSettings, is_observable: true %}
        data-slides-per-view="{{ section.settings.slides_per_view }}"
      >
        <ul class="list-unstyled swiper-wrapper">
          {%- for block in testimonial_blocks -%}
            {%- unless block.settings.video == blank -%}
              <li class="swiper-slide testimonial" {{ block.shopify_attributes }}>
                <video-wrapper>
                  {{
                    block.settings.video
                    | video_tag: image_size: '1100x', autoplay: false, controls: false, loop: false, muted: false
                  }}
                  {% if section.settings.autoplay != true and section.settings.controls != true %}
                    <span class="testimonial__play" data-play-button>
                      {{ 'icon-play.svg' | inline_asset_content }}
                    </span>
                  {% endif %}
                </video-wrapper>
              </li>
            {%- endunless -%}
          {%- endfor -%}
        </ul>
      </div>
      {% if testimonial_blocks.size > 1 %}
        <div class="slider-navigation__button--prev">
          {{ 'icon-arrow-slider.svg' | inline_asset_content }}
        </div>
        <div class="slider-navigation__button--next">
          {{ 'icon-arrow-slider.svg' | inline_asset_content }}
        </div>
      {% endif %}
    {%- endif -%}
  </div>
  <div class="testimonials__text">
    {%- unless section.settings.title == blank -%}
      <h2 class="testimonials__title">{{ section.settings.title }}</h2>
    {%- endunless -%}
    {%- if statistic_blocks.size > 0 -%}
      <div class="testimonials__statistics">
        {%- for block in statistic_blocks -%}
          <div class="statistic">
            <div
              class="icon_progress statistic__progress"
              role="progressbar"
              aria-valuenow="{{ block.settings.percentage }}"
              aria-valuemin="0"
              aria-valuemax="100"
              style="--value: {{ block.settings.percentage }}"
            ></div>
            {%- unless block.settings.text == blank -%}
              <p>{{ block.settings.text }}</p>
            {%- endunless -%}
          </div>
        {%- endfor -%}
      </div>
    {%- endif -%}
    {%- unless section.settings.bottom_text == blank -%}
      <p class="testimonials__bottom-text">{{ section.settings.bottom_text }}</p>
    {%- endunless -%}
    {%- unless section.settings.button_text == blank -%}
      <a href="{{ section.settings.button_url }}" class="testimonials__button button">
        {{- section.settings.button_text -}}
      </a>
    {%- endunless -%}
  </div>
</div>

{% schema %}
{
  "name": "Testimonials",
  "tag": "section",
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "default": "scheme-1"
    },
    {
      "type": "range",
      "id": "slides_per_view",
      "min": 1,
      "max": 3,
      "step": 1,
      "label": "Slides per view",
      "default": 3
    },
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Title"
    },
    {
      "type": "text",
      "id": "bottom_text",
      "label": "Bottom text",
      "default": "* Bottom text"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button text",
      "default": "SHOP NOW"
    },
    {
      "type": "url",
      "id": "button_url",
      "label": "Button URL"
    },
    {
      "type": "header",
      "content": "Section's space between"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 200,
      "step": 2,
      "default": 50,
      "unit": "px",
      "label": "Padding Top"
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 200,
      "step": 2,
      "default": 50,
      "unit": "px",
      "label": "Padding Bottom"
    },
    {
      "type": "range",
      "id": "padding_top_mobile",
      "min": 0,
      "max": 200,
      "step": 2,
      "default": 0,
      "unit": "px",
      "label": "Padding Top Mobile"
    },
    {
      "type": "range",
      "id": "padding_bottom_mobile",
      "min": 0,
      "max": 200,
      "step": 2,
      "default": 0,
      "unit": "px",
      "label": "Padding Bottom Mobile"
    }
  ],
  "blocks": [
    {
      "name": "Testimonial",
      "type": "testimonial",
      "settings": [
        {
          "type": "video",
          "id": "video",
          "label": "Video"
        }
      ]
    },
    {
      "name": "Statistic",
      "type": "statistic",
      "settings": [
        {
          "type": "range",
          "id": "percentage",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "label": "Percentage",
          "default": 90
        },
        {
          "type": "text",
          "id": "text",
          "label": "Text",
          "default": "Text"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Testimonials"
    }
  ]
}
{% endschema %}
