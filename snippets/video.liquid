{% comment %}
  Renders a <video> tag contains video with an abillity to change it for mobile.

  Accepts:
  - video: {Object} Renders video (not youtube/vimeo iframe).
  - video_mobile: {Object} Renders video for mobile using mobile_breakpoint value. (optional)
  - mobile_breakpoint: {Number} Adds a breakpoint in px for media query of mobile video. (optional)
  - playsinline: {Boolean} Adds an abillity to play video in the place where it's situated (e.g. not in full screen mode on mobile). (optional)
  - controls: {Boolean} Enables control buttons on video. (optional)
  - loop: {Boolean} Enables loop mode (video will start over again, every time it is finished). (optional)
  - muted: {Boolean} Disables sound of video. (optional)
  - poster: {Object} Add default image for unstarted video.

  Usage:
  {% render 'video',
    video: video,
    video_mobile: video_mobile,
    media_request: 750,
    autoplay: true,
    controls: false,
    loop: true,
    muted: true,
    poster: image
  %}
{% endcomment %}

{% liquid
  if video == blank
    break
  endif

  assign media_request = media_request | default: 750

  assign attributes = ''
  if autoplay
    assign attributes = attributes | append: 'autoplay '
  endif

  if playsinline
  assign attributes = attributes | append: 'playsinline '
endif

  if controls
    assign attributes = attributes | append: 'controls '
  endif

  if loop
    assign attributes = attributes | append: 'loop '
  endif

  if muted
    assign attributes = attributes | append: 'muted'
  endif
%}

<video
  {% if poster != blank %}poster="{{ poster | img_url: "master" }}"{% endif %}
  {{ attributes }} preload="metadata">
  {% if video_mobile != blank %}
    {% for source in video_mobile.sources %}
      <source src="{{ source.url }}#t=0.1" type="{{ source.mime_type }}" media="(max-width: {{ media_request }}px)">
    {% endfor %}
  {% endif %}
  {% for source in video.sources %}
    <source src="{{ source.url }}#t=0.1" type="{{ source.mime_type }}">
  {% endfor %}
</video>